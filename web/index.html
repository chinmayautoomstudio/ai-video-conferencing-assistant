<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Cross-platform video conferencing application with AI assistance" />
    <meta name="theme-color" content="#1f2937" />
    <title>AI Video Conference Assistant</title>
  </head>
  <body>
    <div id="root"></div>
    <script>
      // Critical polyfills that must be available before any module loads
      console.log('ðŸ”§ [HTML POLYFILLS] Loading critical polyfills...');
      
      // Global polyfill - most critical
      if (typeof global === 'undefined') {
        console.log('ðŸ”§ [HTML POLYFILLS] Adding global polyfill');
        window.global = globalThis;
        globalThis.global = globalThis;
        if (typeof self !== 'undefined') {
          self.global = globalThis;
        }
      }
      
      // Additional global polyfills for Supabase internal dependencies
      if (typeof window !== 'undefined') {
        // Ensure global is available on window
        window.global = window.global || globalThis;
        // Add to any object that might be referenced as 'd'
        if (typeof window.d === 'undefined') {
          window.d = { global: globalThis };
        } else {
          window.d.global = globalThis;
        }
      }
      
      // Process polyfill - comprehensive
      if (typeof process === 'undefined') {
        console.log('ðŸ”§ [HTML POLYFILLS] Adding process polyfill');
        const processPolyfill = {
          env: {},
          browser: true,
          nextTick: function(fn) { return setTimeout(fn, 0); },
          version: 'v16.0.0',
          platform: 'browser',
          cwd: function() { return '/'; },
          chdir: function() {},
          umask: function() { return 0; },
          hrtime: function() { return [0, 0]; },
          uptime: function() { return 0; },
          kill: function() {},
          exit: function() {},
          on: function() {},
          off: function() {},
          emit: function() {},
          addListener: function() {},
          removeListener: function() {},
          removeAllListeners: function() {},
          setMaxListeners: function() {},
          getMaxListeners: function() { return 0; },
          listeners: function() { return []; },
          rawListeners: function() { return []; },
          listenerCount: function() { return 0; },
          eventNames: function() { return []; },
          prependListener: function() {},
          prependOnceListener: function() {},
          once: function() {},
          hasOwnProperty: Object.prototype.hasOwnProperty,
          isPrototypeOf: Object.prototype.isPrototypeOf,
          propertyIsEnumerable: Object.prototype.propertyIsEnumerable,
          toString: function() { return '[object process]'; },
          valueOf: function() { return processPolyfill; }
        };
        
        window.process = processPolyfill;
        globalThis.process = processPolyfill;
        if (typeof self !== 'undefined') {
          self.process = processPolyfill;
        }
      }
      
      // Buffer polyfill
      if (typeof Buffer === 'undefined') {
        console.log('ðŸ”§ [HTML POLYFILLS] Adding Buffer polyfill');
        const bufferPolyfill = {
          isBuffer: function() { return false; },
          from: function() { return new Uint8Array(); },
          alloc: function() { return new Uint8Array(); },
          allocUnsafe: function() { return new Uint8Array(); },
          concat: function() { return new Uint8Array(); },
          compare: function() { return 0; },
          copy: function() { return 0; },
          equals: function() { return false; },
          fill: function() { return bufferPolyfill; },
          indexOf: function() { return -1; },
          lastIndexOf: function() { return -1; },
          readDoubleBE: function() { return 0; },
          readDoubleLE: function() { return 0; },
          readFloatBE: function() { return 0; },
          readFloatLE: function() { return 0; },
          readInt8: function() { return 0; },
          readInt16BE: function() { return 0; },
          readInt16LE: function() { return 0; },
          readInt32BE: function() { return 0; },
          readInt32LE: function() { return 0; },
          readIntBE: function() { return 0; },
          readIntLE: function() { return 0; },
          readUInt8: function() { return 0; },
          readUInt16BE: function() { return 0; },
          readUInt16LE: function() { return 0; },
          readUInt32BE: function() { return 0; },
          readUInt32LE: function() { return 0; },
          readUIntBE: function() { return 0; },
          readUIntLE: function() { return 0; },
          subarray: function() { return new Uint8Array(); },
          swap16: function() { return bufferPolyfill; },
          swap32: function() { return bufferPolyfill; },
          swap64: function() { return bufferPolyfill; },
          toJSON: function() { return { type: 'Buffer', data: [] }; },
          toString: function() { return ''; },
          write: function() { return 0; },
          writeDoubleBE: function() { return 0; },
          writeDoubleLE: function() { return 0; },
          writeFloatBE: function() { return 0; },
          writeFloatLE: function() { return 0; },
          writeInt8: function() { return 0; },
          writeInt16BE: function() { return 0; },
          writeInt16LE: function() { return 0; },
          writeInt32BE: function() { return 0; },
          writeInt32LE: function() { return 0; },
          writeIntBE: function() { return 0; },
          writeIntLE: function() { return 0; },
          writeUInt8: function() { return 0; },
          writeUInt16BE: function() { return 0; },
          writeUInt16LE: function() { return 0; },
          writeUInt32BE: function() { return 0; },
          writeUInt32LE: function() { return 0; },
          writeUIntBE: function() { return 0; },
          writeUIntLE: function() { return 0; }
        };
        
        window.Buffer = bufferPolyfill;
        globalThis.Buffer = bufferPolyfill;
        if (typeof self !== 'undefined') {
          self.Buffer = bufferPolyfill;
        }
      }
      
      // Additional globals
      if (typeof setImmediate === 'undefined') {
        window.setImmediate = function(fn) { return setTimeout(fn, 0); };
        globalThis.setImmediate = function(fn) { return setTimeout(fn, 0); };
      }
      
      if (typeof clearImmediate === 'undefined') {
        window.clearImmediate = clearTimeout;
        globalThis.clearImmediate = clearTimeout;
      }
      
      // Create a comprehensive global object for Supabase
      const createGlobalObject = () => {
        const globalObj = {
          global: globalThis,
          process: window.process || {},
          Buffer: window.Buffer || {},
          setImmediate: window.setImmediate || function(fn) { return setTimeout(fn, 0); },
          clearImmediate: window.clearImmediate || clearTimeout,
          headers: {}, // Add headers object that Supabase might be looking for
          fetch: window.fetch,
          XMLHttpRequest: window.XMLHttpRequest,
          WebSocket: window.WebSocket
        };
        
        // Make it available globally
        window.globalObject = globalObj;
        globalThis.globalObject = globalObj;
        
        // Also create 'd' object that Supabase might be referencing
        window.d = globalObj;
        globalThis.d = globalObj;
        
        return globalObj;
      };
      
      createGlobalObject();
      
      console.log('ðŸ”§ [HTML POLYFILLS] Critical polyfills loaded successfully');
      console.log('ðŸ”§ [HTML POLYFILLS] Global available:', typeof global !== 'undefined');
      console.log('ðŸ”§ [HTML POLYFILLS] Process available:', typeof process !== 'undefined');
      console.log('ðŸ”§ [HTML POLYFILLS] Buffer available:', typeof Buffer !== 'undefined');
      console.log('ðŸ”§ [HTML POLYFILLS] Global object created:', typeof window.globalObject !== 'undefined');
      console.log('ðŸ”§ [HTML POLYFILLS] D object created:', typeof window.d !== 'undefined');
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
